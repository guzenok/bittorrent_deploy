# bittorrent_deploy

## Запуск:

  Вариант 1: ```make && make up``` - контейнеры = голые хосты, consul и deploy_service ставятся на них после запуска с помощью ansible;

  Вариант 2: ```./test.sh``` - контейнеры = хосты с предустановленными  consul и deploy_service;


## Результат:

  Запущено CONTAINERS_COUNT докер-контейнеров, каждый символизирует узел кластера. На каждом запущен consul в роли SD и deploy_service. Рабочии директории каждого deploy_service в test_cluster/storage/host_XXX/.
  Разместив файл в одной, через время получим его во всех.
  Только в первом контейнере установлен ansible для управления остальными, и проброшен порт с UI на http://localhost:8500/.


## Цели make, вариант 1:

* ### build_containers:
  1. генерация ключей для доступа в контейнеры по ssh;
  2. соборка докер-образов хостов;
  3. создание конфигов и директорий для CONTAINERS_COUNT хостов;

* ### up:
  1. компиляция deploy_service;
  2. запуск докер-контейнеров, установка на них consul и deploy_service с помощью ansible и старт;

* ### down:
  1. остановка и удаление докер-контейнеров;

* ### start:
  1. компиляция deploy_service;
  2. запуск ранее остановленных контейнеров;

* ### stop:
  1. остановка докер-контейнеров;

* ### restart:
  1. компиляция deploy_service;
  2. перезапуск его в запущенных контейнерах;


## Цели make, вариант 2:

* ### build_containers:
  1. соборка докер-образов хостов на основе образов из варианта 1;
